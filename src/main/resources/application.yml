# Spring Cloud Gateway routing configuration
# Uses environment variables for flexible service URL configuration
# Spring automatically transforms environment variables:
#   SERVICES_AUTH_URL -> services.auth.url
#   SERVICES_USER_URL -> services.user.url
#   SERVICES_ORDER_URL -> services.order.url
#   SERVICES_PAYMENT_URL -> services.payment.url
# 
# For local development: default values (localhost) from application.properties
# For Docker: variables are set in docker-compose.yml and override defaults
spring:
  cloud:
    gateway:
      httpclient:
        connect-timeout: 5000
        response-timeout: 10s
        pool:
          max-connections: 200
          max-idle-time: 30s
      routes:
        # Route for authentication-service
        - id: auth_route
          uri: ${services.auth.url:http://localhost:8081}
          predicates:
            - Path=/auth/**

        # Route for user-service (users)
        - id: user_route
          uri: ${services.user.url:http://localhost:8080}
          predicates:
            - Path=/api/v1/users/**

        # Route for user-service (cards)
        - id: cards_route
          uri: ${services.user.url:http://localhost:8080}
          predicates:
            - Path=/api/v1/cards/**

        # Route for order-service (orders)
        - id: order_route
          uri: ${services.order.url:http://localhost:8080}
          predicates:
            - Path=/api/v1/orders/**

        # Route for order-service (items)
        - id: items_route
          uri: ${services.order.url:http://localhost:8080}
          predicates:
            - Path=/api/v1/items/**

        # Route for payment-service
        # Using two patterns: one for root path, another for nested
        - id: payment_route
          uri: ${services.payment.url:http://localhost:8085}
          predicates:
            - Path=/api/v1/payments,/api/v1/payments/**
          filters:
            - name: Retry
              args:
                retries: 1
                statuses: BAD_GATEWAY,GATEWAY_TIMEOUT,INTERNAL_SERVER_ERROR
                methods: GET
